<!DOCTYPE html>


<div class="top">
<div class="cover"><img id="cover" src="https://img.genially.com/656427f3b4e82f0019d59fb5/6bd5721d-5339-4ec0-9dcd-7a904bad9118.gif"></div>


<div class="info">
<div class="track-title" id="title">â€”</div>
<div class="progress"><div class="progress-bar" id="bar"></div></div>


<div class="controls">
<button id="prev">â®</button>
<button class="play" id="play">â–¶</button>
<button id="next">â­</button>
<button id="shuffle">ğŸ”€</button>
<button id="list">â‰¡</button>
</div>
</div>
</div>


<div class="playlist" id="playlist"></div>


</div>


<audio id="audio"></audio>


<script>
const q=new URLSearchParams(location.search);
const repo=q.get('repo');
const path=q.get('path')||'audio';
const primary=q.get('primary');


if(primary)document.documentElement.style.setProperty('--primary',primary);


const base=`https://raw.githubusercontent.com/${repo}/main/${path}/`;
const audio=document.getElementById('audio');
const titleEl=document.getElementById('title');
const bar=document.getElementById('bar');
const playlistEl=document.getElementById('playlist');
const cover=document.getElementById('cover');


let tracks=[],index=0,shuffle=false;


fetch(base+'playlist.json').then(r=>r.json()).then(data=>{
tracks=data.tracks;
cover.src=base+(data.cover||'cover.jpg');
load(0);
render();
});


function load(i){
index=i;
audio.src=base+tracks[i].file;
titleEl.textContent=tracks[i].title;
}


function render(){
playlistEl.innerHTML='';
tracks.forEach((t,i)=>{
const d=document.createElement('div');
d.textContent=t.title;
d.onclick=()=>{load(i);audio.play();};
playlistEl.appendChild(d);
});
}


play.onclick=()=>audio.paused?audio.play():audio.pause();
next.onclick=()=>load((index+1)%tracks.length);
prev.onclick=()=>load((index-1+tracks.length)%tracks.length);
shuffle.onclick=()=>shuffle=!shuffle;
list.onclick=()=>playlistEl.classList.toggle('active');


audio.ontimeupdate=()=>bar.style.width=(audio.currentTime/audio.duration*100)+'%';


audio.onended=()=>{
shuffle?load(Math.floor(Math.random()*tracks.length)):next.onclick();
audio.play();
};
</script>


</body>
</html>
